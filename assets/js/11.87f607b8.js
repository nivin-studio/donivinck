(window.webpackJsonp=window.webpackJsonp||[]).push([[11],{432:function(s,t,e){"use strict";e.r(t);var a=e(65),n=Object(a.a)({},(function(){var s=this,t=s.$createElement,e=s._self._c||t;return e("ContentSlotsDistributor",{attrs:{"slot-key":s.$parent.slotKey}},[e("h1",{attrs:{id:"redis-cluster搭建"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#redis-cluster搭建"}},[s._v("#")]),s._v(" Redis Cluster搭建")]),s._v(" "),e("blockquote",[e("p",[s._v("Redis Cluster 是一个提供在多个 Redis 节点间共享数据的程序集。\nRedis Cluster 并不支持处理多个 keys 的命令，因为这需要在不同的节点间移动数据，所以达不到像 Redis 那样的性能，在高负载的情况下可能会导致不可预料的错误。\nRedis Cluster 集群通过分区来提供一定程度的可用性，在实际环境中当某个节点宕机或者不可达的情况下继续处理命令。")])]),s._v(" "),e("h2",{attrs:{id:"获取redis镜像"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#获取redis镜像"}},[s._v("#")]),s._v(" 获取Redis镜像")]),s._v(" "),e("div",{staticClass:"language-bash extra-class"},[e("pre",{pre:!0,attrs:{class:"language-bash"}},[e("code",[s._v("$ "),e("span",{pre:!0,attrs:{class:"token function"}},[s._v("docker")]),s._v(" pull nivinivin/redis\n")])])]),e("h2",{attrs:{id:"创建redis集群网络"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#创建redis集群网络"}},[s._v("#")]),s._v(" 创建redis集群网络")]),s._v(" "),e("div",{staticClass:"language-bash extra-class"},[e("pre",{pre:!0,attrs:{class:"language-bash"}},[e("code",[s._v("$ "),e("span",{pre:!0,attrs:{class:"token function"}},[s._v("docker")]),s._v(" network create --subnet"),e("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),e("span",{pre:!0,attrs:{class:"token number"}},[s._v("172.19")]),s._v(".0.0/16 redis_net\n")])])]),e("h2",{attrs:{id:"创建6节点redis容器"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#创建6节点redis容器"}},[s._v("#")]),s._v(" 创建6节点Redis容器")]),s._v(" "),e("div",{staticClass:"language-bash extra-class"},[e("pre",{pre:!0,attrs:{class:"language-bash"}},[e("code",[s._v("$ "),e("span",{pre:!0,attrs:{class:"token function"}},[s._v("docker")]),s._v(" run -it -d --name redis1 -p "),e("span",{pre:!0,attrs:{class:"token number"}},[s._v("6001")]),s._v(":6379 -p "),e("span",{pre:!0,attrs:{class:"token number"}},[s._v("16001")]),s._v(":16379 --net"),e("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v("redis_net --ip "),e("span",{pre:!0,attrs:{class:"token number"}},[s._v("172.19")]),s._v(".0.2 nivinivin/redis "),e("span",{pre:!0,attrs:{class:"token function"}},[s._v("bash")]),s._v("\n$ "),e("span",{pre:!0,attrs:{class:"token function"}},[s._v("docker")]),s._v(" run -it -d --name redis2 -p "),e("span",{pre:!0,attrs:{class:"token number"}},[s._v("6002")]),s._v(":6379 -p "),e("span",{pre:!0,attrs:{class:"token number"}},[s._v("16002")]),s._v(":16379 --net"),e("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v("redis_net --ip "),e("span",{pre:!0,attrs:{class:"token number"}},[s._v("172.19")]),s._v(".0.3 nivinivin/redis "),e("span",{pre:!0,attrs:{class:"token function"}},[s._v("bash")]),s._v("\n$ "),e("span",{pre:!0,attrs:{class:"token function"}},[s._v("docker")]),s._v(" run -it -d --name redis3 -p "),e("span",{pre:!0,attrs:{class:"token number"}},[s._v("6003")]),s._v(":6379 -p "),e("span",{pre:!0,attrs:{class:"token number"}},[s._v("16003")]),s._v(":16379 --net"),e("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v("redis_net --ip "),e("span",{pre:!0,attrs:{class:"token number"}},[s._v("172.19")]),s._v(".0.4 nivinivin/redis "),e("span",{pre:!0,attrs:{class:"token function"}},[s._v("bash")]),s._v("\n$ "),e("span",{pre:!0,attrs:{class:"token function"}},[s._v("docker")]),s._v(" run -it -d --name redis4 -p "),e("span",{pre:!0,attrs:{class:"token number"}},[s._v("6004")]),s._v(":6379 -p "),e("span",{pre:!0,attrs:{class:"token number"}},[s._v("16004")]),s._v(":16379 --net"),e("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v("redis_net --ip "),e("span",{pre:!0,attrs:{class:"token number"}},[s._v("172.19")]),s._v(".0.5 nivinivin/redis "),e("span",{pre:!0,attrs:{class:"token function"}},[s._v("bash")]),s._v("\n$ "),e("span",{pre:!0,attrs:{class:"token function"}},[s._v("docker")]),s._v(" run -it -d --name redis5 -p "),e("span",{pre:!0,attrs:{class:"token number"}},[s._v("6005")]),s._v(":6379 -p "),e("span",{pre:!0,attrs:{class:"token number"}},[s._v("16005")]),s._v(":16379 --net"),e("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v("redis_net --ip "),e("span",{pre:!0,attrs:{class:"token number"}},[s._v("172.19")]),s._v(".0.6 nivinivin/redis "),e("span",{pre:!0,attrs:{class:"token function"}},[s._v("bash")]),s._v("\n$ "),e("span",{pre:!0,attrs:{class:"token function"}},[s._v("docker")]),s._v(" run -it -d --name redis6 -p "),e("span",{pre:!0,attrs:{class:"token number"}},[s._v("6006")]),s._v(":6379 -p "),e("span",{pre:!0,attrs:{class:"token number"}},[s._v("16006")]),s._v(":16379 --net"),e("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v("redis_net --ip "),e("span",{pre:!0,attrs:{class:"token number"}},[s._v("172.19")]),s._v(".0.7 nivinivin/redis "),e("span",{pre:!0,attrs:{class:"token function"}},[s._v("bash")]),s._v("\n")])])]),e("div",{staticClass:"custom-block tip"},[e("p",{staticClass:"custom-block-title"},[s._v("提示")]),s._v(" "),e("p",[s._v("Redis 配置文件里必须要设置 bind 0.0.0.0，这是允许其他IP可以访问当前 Redis 。如果不设置这个参数，就不能组建 Redis 集群。")])]),s._v(" "),e("div",{staticClass:"custom-block tip"},[e("p",{staticClass:"custom-block-title"},[s._v("提示")]),s._v(" "),e("p",[s._v("如果6个节点的端口号分别是6001，6002，6003，6004，6005，6006。那么防火墙需要打开这个6个端口号，并且还需要打开16001，16002，16003，16004，16005，16006这6个"),e("a",{attrs:{href:"https://redis.io/topics/cluster-tutorial",target:"_blank",rel:"noopener noreferrer"}},[s._v("集群总线端口"),e("OutboundLink")],1),s._v("。")])]),s._v(" "),e("h2",{attrs:{id:"启动6节点redis容器"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#启动6节点redis容器"}},[s._v("#")]),s._v(" 启动6节点Redis容器")]),s._v(" "),e("h3",{attrs:{id:"进入redis1节点容器修改配置"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#进入redis1节点容器修改配置"}},[s._v("#")]),s._v(" 进入redis1节点容器修改配置")]),s._v(" "),e("div",{staticClass:"language-bash extra-class"},[e("pre",{pre:!0,attrs:{class:"language-bash"}},[e("code",[s._v("$ "),e("span",{pre:!0,attrs:{class:"token function"}},[s._v("docker")]),s._v(" "),e("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v("exec")]),s._v(" -it redis1 "),e("span",{pre:!0,attrs:{class:"token function"}},[s._v("bash")]),s._v("\n$ "),e("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v("cd")]),s._v(" /home/redis\n$ "),e("span",{pre:!0,attrs:{class:"token function"}},[s._v("vim")]),s._v(" redis.conf\n"),e("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 添加下面三行配置")]),s._v("\n"),e("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# cluster-announce-ip XXX.XXX.XXX.XXX  宿主机真实IP")]),s._v("\n"),e("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# cluster-announce-port 6001")]),s._v("\n"),e("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# cluster-announce-bus-port 16001")]),s._v("\n$ redis-server ./redis.conf\n")])])]),e("h3",{attrs:{id:"进入redis2节点容器修改配置"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#进入redis2节点容器修改配置"}},[s._v("#")]),s._v(" 进入redis2节点容器修改配置")]),s._v(" "),e("div",{staticClass:"language-bash extra-class"},[e("pre",{pre:!0,attrs:{class:"language-bash"}},[e("code",[s._v("$ "),e("span",{pre:!0,attrs:{class:"token function"}},[s._v("docker")]),s._v(" "),e("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v("exec")]),s._v(" -it redis2 "),e("span",{pre:!0,attrs:{class:"token function"}},[s._v("bash")]),s._v("\n$ "),e("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v("cd")]),s._v(" /home/redis\n$ "),e("span",{pre:!0,attrs:{class:"token function"}},[s._v("vim")]),s._v(" redis.conf\n"),e("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#添加下面三行配置")]),s._v("\n"),e("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#cluster-announce-ip XXX.XXX.XXX.XXX  宿主机真实IP")]),s._v("\n"),e("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#cluster-announce-port 6002")]),s._v("\n"),e("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#cluster-announce-bus-port 16002")]),s._v("\n$ redis-server ./redis.conf\n")])])]),e("h3",{attrs:{id:"进入redis3节点容器修改配置"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#进入redis3节点容器修改配置"}},[s._v("#")]),s._v(" 进入redis3节点容器修改配置")]),s._v(" "),e("div",{staticClass:"language-bash extra-class"},[e("pre",{pre:!0,attrs:{class:"language-bash"}},[e("code",[s._v("$ "),e("span",{pre:!0,attrs:{class:"token function"}},[s._v("docker")]),s._v(" "),e("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v("exec")]),s._v(" -it redis3 "),e("span",{pre:!0,attrs:{class:"token function"}},[s._v("bash")]),s._v("\n$ "),e("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v("cd")]),s._v(" /home/redis\n$ "),e("span",{pre:!0,attrs:{class:"token function"}},[s._v("vim")]),s._v(" redis.conf\n"),e("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#添加下面三行配置")]),s._v("\n"),e("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#cluster-announce-ip XXX.XXX.XXX.XXX  宿主机真实IP")]),s._v("\n"),e("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#cluster-announce-port 6003")]),s._v("\n"),e("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#cluster-announce-bus-port 16003")]),s._v("\n$ redis-server ./redis.conf\n")])])]),e("h3",{attrs:{id:"进入redis4节点容器修改配置"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#进入redis4节点容器修改配置"}},[s._v("#")]),s._v(" 进入redis4节点容器修改配置")]),s._v(" "),e("div",{staticClass:"language-bash extra-class"},[e("pre",{pre:!0,attrs:{class:"language-bash"}},[e("code",[s._v("$ "),e("span",{pre:!0,attrs:{class:"token function"}},[s._v("docker")]),s._v(" "),e("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v("exec")]),s._v(" -it redis4 "),e("span",{pre:!0,attrs:{class:"token function"}},[s._v("bash")]),s._v("\n$ "),e("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v("cd")]),s._v(" /home/redis\n$ "),e("span",{pre:!0,attrs:{class:"token function"}},[s._v("vim")]),s._v(" redis.conf\n"),e("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#添加下面三行配置")]),s._v("\n"),e("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#cluster-announce-ip XXX.XXX.XXX.XXX  宿主机真实IP")]),s._v("\n"),e("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#cluster-announce-port 6004")]),s._v("\n"),e("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#cluster-announce-bus-port 16004")]),s._v("\n$ redis-server ./redis.conf\n")])])]),e("h3",{attrs:{id:"进入redis5节点容器修改配置"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#进入redis5节点容器修改配置"}},[s._v("#")]),s._v(" 进入redis5节点容器修改配置")]),s._v(" "),e("div",{staticClass:"language-bash extra-class"},[e("pre",{pre:!0,attrs:{class:"language-bash"}},[e("code",[s._v("$ "),e("span",{pre:!0,attrs:{class:"token function"}},[s._v("docker")]),s._v(" "),e("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v("exec")]),s._v(" -it redis5 "),e("span",{pre:!0,attrs:{class:"token function"}},[s._v("bash")]),s._v("\n$ "),e("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v("cd")]),s._v(" /home/redis\n$ "),e("span",{pre:!0,attrs:{class:"token function"}},[s._v("vim")]),s._v(" redis.conf\n"),e("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#添加下面三行配置")]),s._v("\n"),e("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#cluster-announce-ip XXX.XXX.XXX.XXX  宿主机真实IP")]),s._v("\n"),e("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#cluster-announce-port 6005")]),s._v("\n"),e("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#cluster-announce-bus-port 16005")]),s._v("\n$ redis-server ./redis.conf\n")])])]),e("h3",{attrs:{id:"进入redis6节点容器修改配置"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#进入redis6节点容器修改配置"}},[s._v("#")]),s._v(" 进入redis6节点容器修改配置")]),s._v(" "),e("div",{staticClass:"language-bash extra-class"},[e("pre",{pre:!0,attrs:{class:"language-bash"}},[e("code",[s._v("$ "),e("span",{pre:!0,attrs:{class:"token function"}},[s._v("docker")]),s._v(" "),e("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v("exec")]),s._v(" -it redis6 "),e("span",{pre:!0,attrs:{class:"token function"}},[s._v("bash")]),s._v("\n$ "),e("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v("cd")]),s._v(" /home/redis\n$ "),e("span",{pre:!0,attrs:{class:"token function"}},[s._v("vim")]),s._v(" redis.conf\n"),e("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#添加下面三行配置")]),s._v("\n"),e("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#cluster-announce-ip XXX.XXX.XXX.XXX  宿主机真实IP")]),s._v("\n"),e("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#cluster-announce-port 6006")]),s._v("\n"),e("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#cluster-announce-bus-port 16006")]),s._v("\n$ redis-server ./redis.conf\n")])])]),e("h2",{attrs:{id:"创建集群"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#创建集群"}},[s._v("#")]),s._v(" 创建集群")]),s._v(" "),e("div",{staticClass:"language-bash extra-class"},[e("pre",{pre:!0,attrs:{class:"language-bash"}},[e("code",[e("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#在redis1节点上执行下面的指令")]),s._v("\n$ "),e("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v("cd")]),s._v(" /home/redis\n"),e("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#创建集群(如果是宿主机共享模式，请使用宿主机的真实IP和端口号)")]),s._v("\n$ ./redis-trib.rb create --replicas "),e("span",{pre:!0,attrs:{class:"token number"}},[s._v("1")]),s._v(" "),e("span",{pre:!0,attrs:{class:"token number"}},[s._v("172.19")]),s._v(".0.2:6379 "),e("span",{pre:!0,attrs:{class:"token number"}},[s._v("172.19")]),s._v(".0.3:6379 "),e("span",{pre:!0,attrs:{class:"token number"}},[s._v("172.19")]),s._v(".0.4:6379 "),e("span",{pre:!0,attrs:{class:"token number"}},[s._v("172.19")]),s._v(".0.5:6379 "),e("span",{pre:!0,attrs:{class:"token number"}},[s._v("172.19")]),s._v(".0.6:6379 "),e("span",{pre:!0,attrs:{class:"token number"}},[s._v("172.19")]),s._v(".0.7:6379\n")])])])])}),[],!1,null,null,null);t.default=n.exports}}]);